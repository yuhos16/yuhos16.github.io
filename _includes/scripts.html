<script src="assets/js/main.min.js"></script>

{% include analytics.html %}
{% include fetch_google_scholar_stats.html %}
<script>
  (function(){
    function getPreferredTheme(){
      var saved = localStorage.getItem('theme');
      if(saved === 'dark' || saved === 'light') return saved;
      return window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    }
    function setIcon(theme){
      var btn = document.getElementById('theme-toggle-btn');
      if(!btn) return;
      var sun = btn.querySelector('.icon-sun');
      var moon = btn.querySelector('.icon-moon');
      if(sun && moon){
        sun.style.display = theme === 'dark' ? 'inline' : 'none';
        moon.style.display = theme === 'dark' ? 'none' : 'inline';
      }
      btn.setAttribute('title', theme === 'dark' ? '切换为浅色' : '切换为深色');
    }
    function applyTheme(theme){
      var root = document.documentElement;
      if(theme === 'dark'){
        root.classList.add('theme-dark');
      } else {
        root.classList.remove('theme-dark');
      }
      localStorage.setItem('theme', theme);
      setIcon(theme);
    }
    document.addEventListener('DOMContentLoaded', function(){
      applyTheme(getPreferredTheme());
      document.addEventListener('click', function(e){
        var t = e.target;
        if(t && t.id === 'theme-toggle-btn'){
          e.preventDefault();
          applyTheme(document.documentElement.classList.contains('theme-dark') ? 'light' : 'dark');
        }
      });
    });
  })();
</script>
